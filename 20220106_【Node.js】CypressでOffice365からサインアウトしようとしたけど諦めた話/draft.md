# はじまり

つい先日、Cypressを使って、テスト用のOffice365アカウントから使用するシステムのテスト自動化が出来ないかと思い、調査し始めました。その時の記事になります。

まず、このログイン処理が最初であり最もデカい関門であることは分かっていましたが、まだ数行しかコードを書いていないところで何時間も詰まるとは思いませんでした・・・。

結論としては、怪しいDOMを全部clickしましたがサインアウト出来なかったので諦めました笑

以下、詳細になります。

# システムへの遷移の流れ

システムへの遷移の流れは、当初は以下の通りでしす。とりあえず、これで進めていきました。

1. Office365のサインイン画面``に行く。
1. サインイン画面でサインインボタンを押すと、自分の端末にログインしているアカウントで自動サインインされる。
1. Office365のホーム画面に行くので、そこからサインアウトする。
1. そうすると、別のアカウントのユーザー名を入力できるページに飛べる。
1. 飛べたら、ブラウザのCookieやらキャッシュを消す。
1. 先程のページで、テスト用アカウントのユーザー名を入力して、パスワード入力画面やサインイン継続しますか？画面などと色々遷移する。
1. テスト用アカウントのホーム画面に遷移する。
1. そこから、システムのアプリのボタンをクリックして、、またもやサインイン継続しますか？画面など色々遷移する。
1. アプリに到着！

流れはこんなもので、以下が過程になります。

# まず、CORSで引っ掛かる

Cypressを使ってる殆どの方が引っ掛かったであろう、CORS制限です。
Cypressでは、１つのテストで２つ以上のオリジンに遷移しようとすると、`CypressError`になり遷移できません。

これは、[Cypressのリファレンス](https://docs.cypress.io/guides/guides/web-security)にも載っている通り、`C:\Users\%USERNAME%\cypress.json`に以下のkey-valueを入れればよいです。（・・・Cypressのこのjsonファイルとか`integration`フォルダとか、デフォルトのファイル配置すごいバラバラだよなあ・・・Everythingがなかったら見つけられんかったぞ・・・。）

```json:cypress.json
{
  "chromeWebSecurity": false
}
```

これで、サインインは出来て、Office365のホーム画面には遷移できました。

（画面のキャプチャ）

# サインアウトするために

このホーム画面からサインアウトするためには、まず、この

# 

# おしまい

